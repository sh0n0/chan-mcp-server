name: CI

on:
  pull_request:
  push:
    branches: [ main ]
  release:
    types: [published]

permissions:
  contents: read
  id-token: write

jobs:
    ci:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v5

        - name: Set up pnpm
          uses: pnpm/action-setup@v4
          with:
            version: 10.20.0

        - name: Set up Node.js
          uses: actions/setup-node@v5
          with:
            node-version: 24.10.0
            cache: "pnpm"

        - name: Install dependencies
          run: pnpm install

        - name: Lint
          run: pnpm run lint

        - name: Build
          run: pnpm run build
        
        - name: Publish
          if: github.event_name == 'release' && github.event.action == 'published'
          run: npm install -g npm@latest && pnpm publish --no-git-checks
